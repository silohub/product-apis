name: Publish API Packages
on:
  push:
    branches:
      - develop
      - master
jobs:
  publish:
    name: Publish API Docs and Packages
    runs-on: ubuntu-latest
    env:
      # esta es la variable que usa npm para publicar
      ORG_GRADLE_PROJECT_shghUser: "silohub"
      DEPLOY_TOKEN: ${{ secrets.DEPLOY_TOKEN }}
      NODE_AUTH_TOKEN: ${{ secrets.NPM_PUBLISH_TOKEN }}
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v2.3.1
      - uses: pnpm/action-setup@v2.0.1
        with:
          version: 6.26.1
          run_install: true
      - uses: actions/setup-node@v2
        with:
          node-version: '16.13.1'
          cache: 'pnpm'
          registry-url: 'https://registry.npmjs.org/'
          scope: '@silohub'
      - name: Git branch name
        id: git-branch-name
        uses: EthanSK/git-branch-name-action@v1
      - uses: ASzc/change-string-case-action@v2
        id: GIT_BRANCH
        with:
          string: ${{ env.GIT_BRANCH_NAME }}
      - name: Setup
        run: bin/github/setup.sh
      - name: Validate
        run: bin/github/validate-apis.sh
      - name: Generate
        run: bin/github/generate-apis.sh
      - name: Publish
        run: bin/github/publish-apis.sh
#      - name: Deploy to GitHub Pages
#        uses: JamesIves/github-pages-deploy-action@v4.2.2
#        with:
#          branch: gh-pages
#          folder: build/docs
#          destination: adsa
#          target-folder: docs/${{ env.GIT_BRANCH_NAME }}
#          clean: false
#      - name: Generate NPM Internal Packages
#        run: bin/github/publish-internal-packages.sh
#        env:
#          # esta es la variable que usa npm para publicar
#          NODE_AUTH_TOKEN: ${{ secrets.NPM_PUBLISH_TOKEN }}
#          BUILD_NUMBER: ${{ github.run_number }}
